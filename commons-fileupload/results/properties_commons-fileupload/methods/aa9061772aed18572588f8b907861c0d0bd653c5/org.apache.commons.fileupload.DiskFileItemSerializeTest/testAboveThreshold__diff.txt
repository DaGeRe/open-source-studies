/**                                                                                                    /**                                                                                                 
* Test creation of a field for which the amount of data falls above the                                * Test creation of a field for which the amount of data falls above the                             
* configured threshold.                                                                                * configured threshold.                                                                             
*/                                                                                                     */                                                                                                  
@Test                                                                                                  @Test                                                                                               
public void testAboveThreshold() throws Exception {                                                    public void testAboveThreshold() throws Exception {                                                 
// Create the FileItem                                                                                 // Create the FileItem                                                                              
byte[] testFieldValueBytes = createContentBytes(threshold + 1);                                        byte[] testFieldValueBytes = createContentBytes(threshold + 1);                                     
FileItem item = createFileItem(testFieldValueBytes);                                                   FileItem item = createFileItem(testFieldValueBytes);                                                
// Check state is as expected                                                                          // Check state is as expected                                                                       
assertFalse("Initial: in memory", item.isInMemory());                                                  assertFalse("Initial: in memory", item.isInMemory());                                               
assertEquals("Initial: size", item.getSize(), testFieldValueBytes.length);                             assertEquals("Initial: size", item.getSize(), testFieldValueBytes.length);                          
compareBytes("Initial", item.get(), testFieldValueBytes);                                              compareBytes("Initial", item.get(), testFieldValueBytes);                                           
// Serialize & Deserialize                                                                           |                                                                                                     
FileItem newItem = (FileItem) serializeDeserialize(item);                                            |                                                                                                     
// Test deserialized content is as expected                                                          |                                                                                                     
assertFalse("Check in memory", newItem.isInMemory());                                                |                                                                                                     
compareBytes("Check", testFieldValueBytes, newItem.get());                                           |                                                                                                     
// Compare FileItem's (except byte[])                                                                |                                                                                                     
compareFileItems(item, newItem);                                                                     |                                                                                                     
item.delete();                                                                                         item.delete();                                                                                      
newItem.delete();                                                                                    |                                                                                                     
}                                                                                                      }                                                                                                   
