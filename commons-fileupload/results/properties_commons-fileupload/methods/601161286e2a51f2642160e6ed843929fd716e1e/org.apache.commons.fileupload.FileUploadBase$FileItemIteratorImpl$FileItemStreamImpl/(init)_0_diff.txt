/**                                                                                                    /**                                                                                                 
* Creates a new instance.                                                                              * Creates a new instance.                                                                           
*                                                                                                      *                                                                                                   
* @param pName The items file name, or null.                                                           * @param pName The items file name, or null.                                                        
* @param pFieldName The items field name.                                                              * @param pFieldName The items field name.                                                           
* @param pContentType The items content type, or null.                                                 * @param pContentType The items content type, or null.                                              
* @param pFormField Whether the item is a form field.                                                  * @param pFormField Whether the item is a form field.                                               
* @param pContentLength The items content length, if known, or -1                                      * @param pContentLength The items content length, if known, or -1                                   
* @throws IOException Creating the file item failed.                                                   * @throws IOException Creating the file item failed.                                                
*/                                                                                                     */                                                                                                  
FileItemStreamImpl(String pName, String pFieldName, String pContentType, boolean pFormField, long pC   FileItemStreamImpl(String pName, String pFieldName, String pContentType, boolean pFormField, long pC
name = pName;                                                                                          name = pName;                                                                                       
fieldName = pFieldName;                                                                                fieldName = pFieldName;                                                                             
contentType = pContentType;                                                                            contentType = pContentType;                                                                         
formField = pFormField;                                                                                formField = pFormField;                                                                             
final ItemInputStream itemStream = multi.newInputStream();                                             final ItemInputStream itemStream = multi.newInputStream();                                          
InputStream istream = itemStream;                                                                      InputStream istream = itemStream;                                                                   
if (fileSizeMax != -1) {                                                                               if (fileSizeMax != -1) {                                                                            
if (pContentLength != -1 && pContentLength &gt; fileSizeMax) {                                         if (pContentLength != -1 && pContentLength &gt; fileSizeMax) {                                      
FileSizeLimitExceededException e = new FileSizeLimitExceededException(format("The field %s exceeds i | FileSizeLimitExceededException e = new FileSizeLimitExceededException(format("The field %s exceeds i
e.setFileName(pName);                                                                                  e.setFileName(pName);                                                                               
e.setFieldName(pFieldName);                                                                            e.setFieldName(pFieldName);                                                                         
throw new FileUploadIOException(e);                                                                    throw new FileUploadIOException(e);                                                                 
}                                                                                                      }                                                                                                   
istream = new LimitedInputStream(istream, fileSizeMax) {                                               istream = new LimitedInputStream(istream, fileSizeMax) {                                            
                                                                                                                                                                                                           
@Override                                                                                              @Override                                                                                           
protected void raiseError(long pSizeMax, long pCount) throws IOException {                             protected void raiseError(long pSizeMax, long pCount) throws IOException {                          
itemStream.close(true);                                                                                itemStream.close(true);                                                                             
FileSizeLimitExceededException e = new FileSizeLimitExceededException(format("The field %s exceeds i | FileSizeLimitExceededException e = new FileSizeLimitExceededException(format("The field %s exceeds i
e.setFieldName(fieldName);                                                                             e.setFieldName(fieldName);                                                                          
e.setFileName(name);                                                                                   e.setFileName(name);                                                                                
throw new FileUploadIOException(e);                                                                    throw new FileUploadIOException(e);                                                                 
}                                                                                                      }                                                                                                   
};                                                                                                     };                                                                                                  
}                                                                                                      }                                                                                                   
stream = istream;                                                                                      stream = istream;                                                                                   
}                                                                                                      }                                                                                                   
