private long readLines(final RandomAccessFile reader) throws IOException {                             private long readLines(final RandomAccessFile reader) throws IOException {                          
ByteArrayOutputStream lineBuf = new ByteArrayOutputStream(64);                                       | try (ByteArrayOutputStream lineBuf = new ByteArrayOutputStream(64)) {                               
long pos = reader.getFilePointer();                                                                    long pos = reader.getFilePointer();                                                                 
long rePos = pos;                                                                                      long rePos = pos;                                                                                   
int num;                                                                                               int num;                                                                                            
boolean seenCR = false;                                                                                boolean seenCR = false;                                                                             
while (getRun() && ((num = reader.read(inbuf)) != EOF)) {                                              while (getRun() && ((num = reader.read(inbuf)) != EOF)) {                                           
for (int i = 0; i &lt; num; i++) {                                                                     for (int i = 0; i &lt; num; i++) {                                                                  
final byte ch = inbuf[i];                                                                              final byte ch = inbuf[i];                                                                           
switch(ch) {                                                                                           switch(ch) {                                                                                        
case '\n':                                                                                             case '\n':                                                                                          
seenCR = false;                                                                                        seenCR = false;                                                                                     
listener.handle(new String(lineBuf.toByteArray(), cset));                                              listener.handle(new String(lineBuf.toByteArray(), cset));                                           
lineBuf.reset();                                                                                       lineBuf.reset();                                                                                    
rePos = pos + i + 1;                                                                                   rePos = pos + i + 1;                                                                                
break;                                                                                                 break;                                                                                              
case '\r':                                                                                             case '\r':                                                                                          
if (seenCR) {                                                                                          if (seenCR) {                                                                                       
lineBuf.write('\r');                                                                                   lineBuf.write('\r');                                                                                
}                                                                                                      }                                                                                                   
seenCR = true;                                                                                         seenCR = true;                                                                                      
break;                                                                                                 break;                                                                                              
default:                                                                                               default:                                                                                            
if (seenCR) {                                                                                          if (seenCR) {                                                                                       
seenCR = false;                                                                                        seenCR = false;                                                                                     
listener.handle(new String(lineBuf.toByteArray(), cset));                                              listener.handle(new String(lineBuf.toByteArray(), cset));                                           
lineBuf.reset();                                                                                       lineBuf.reset();                                                                                    
rePos = pos + i + 1;                                                                                   rePos = pos + i + 1;                                                                                
}                                                                                                      }                                                                                                   
lineBuf.write(ch);                                                                                     lineBuf.write(ch);                                                                                  
}                                                                                                      }                                                                                                   
}                                                                                                      }                                                                                                   
pos = reader.getFilePointer();                                                                         pos = reader.getFilePointer();                                                                      
}                                                                                                      }                                                                                                   
IOUtils.closeQuietly(lineBuf);                                                                       |                                                                                                     
reader.seek(rePos);                                                                                    reader.seek(rePos);                                                                                 
if (listener instanceof TailerListenerAdapter) {                                                       if (listener instanceof TailerListenerAdapter) {                                                    
((TailerListenerAdapter) listener).endOfFileReached();                                                 ((TailerListenerAdapter) listener).endOfFileReached();                                              
}                                                                                                      }                                                                                                   
return rePos;                                                                                          return rePos;                                                                                       
}                                                                                                      }                                                                                                   
                                                                                                     | }                                                                                                   
