private static String doGetPath(String filename, int separatorAdd) {                                   private static String doGetPath(String filename, int separatorAdd) {                                
if (filename == null) {                                                                                if (filename == null) {                                                                             
return null;                                                                                           return null;                                                                                        
}                                                                                                      }                                                                                                   
int prefix = getPrefixLength(filename);                                                                int prefix = getPrefixLength(filename);                                                             
if (prefix &lt; 0) {                                                                                   if (prefix &lt; 0) {                                                                                
return null;                                                                                           return null;                                                                                        
}                                                                                                      }                                                                                                   
int index = indexOfLastSeparator(filename);                                                            int index = indexOfLastSeparator(filename);                                                         
if (prefix &gt;= filename.length() || index &lt; 0) {                                                | int endIndex = index + separatorAdd;                                                                
                                                                                                     | if (prefix &gt;= filename.length() || index &lt; 0 || prefix &gt;= endIndex) {                      
return "";                                                                                             return "";                                                                                          
}                                                                                                      }                                                                                                   
return filename.substring(prefix, index + separatorAdd);                                             | return filename.substring(prefix, endIndex);                                                        
}                                                                                                      }                                                                                                   
