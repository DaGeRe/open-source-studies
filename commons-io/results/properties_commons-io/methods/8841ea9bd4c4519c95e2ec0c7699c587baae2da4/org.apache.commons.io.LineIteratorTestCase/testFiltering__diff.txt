public void testFiltering() throws Exception {                                                         public void testFiltering() throws Exception {                                                      
String encoding = "UTF-8";                                                                             String encoding = "UTF-8";                                                                          
String fileName = "LineIterator-Filter-test.txt";                                                      String fileName = "LineIterator-Filter-test.txt";                                                   
File testFile = new File(getTestDirectory(), fileName);                                                File testFile = new File(getTestDirectory(), fileName);                                             
List lines = createFile(testFile, encoding, 9);                                                      | List&lt;String&gt; lines = createFile(testFile, encoding, 9);                                       
Reader reader = new FileReader(testFile);                                                              Reader reader = new FileReader(testFile);                                                           
LineIterator iterator = new LineIterator(reader) {                                                     LineIterator iterator = new LineIterator(reader) {                                                  
                                                                                                                                                                                                           
@Override                                                                                              @Override                                                                                           
protected boolean isValidLine(String line) {                                                           protected boolean isValidLine(String line) {                                                        
char c = line.charAt(line.length() - 1);                                                               char c = line.charAt(line.length() - 1);                                                            
return ((c - 48) % 3 != 1);                                                                            return ((c - 48) % 3 != 1);                                                                         
}                                                                                                      }                                                                                                   
};                                                                                                     };                                                                                                  
try {                                                                                                  try {                                                                                               
try {                                                                                                  try {                                                                                               
iterator.remove();                                                                                     iterator.remove();                                                                                  
fail("Remove is unsupported");                                                                         fail("Remove is unsupported");                                                                      
} catch (UnsupportedOperationException ex) {                                                           } catch (UnsupportedOperationException ex) {                                                        
}                                                                                                      }                                                                                                   
int idx = 0;                                                                                           int idx = 0;                                                                                        
int actualLines = 0;                                                                                   int actualLines = 0;                                                                                
while (iterator.hasNext()) {                                                                           while (iterator.hasNext()) {                                                                        
String line = (String) iterator.next();                                                              | String line = iterator.next();                                                                      
actualLines++;                                                                                         actualLines++;                                                                                      
assertEquals("Comparing line " + idx, lines.get(idx), line);                                           assertEquals("Comparing line " + idx, lines.get(idx), line);                                        
assertTrue("Exceeded expected idx=" + idx + " size=" + lines.size(), idx &lt; lines.size());           assertTrue("Exceeded expected idx=" + idx + " size=" + lines.size(), idx &lt; lines.size());        
idx++;                                                                                                 idx++;                                                                                              
if (idx % 3 == 1) {                                                                                    if (idx % 3 == 1) {                                                                                 
idx++;                                                                                                 idx++;                                                                                              
}                                                                                                      }                                                                                                   
}                                                                                                      }                                                                                                   
assertEquals("Line Count doesn't match", 9, lines.size());                                             assertEquals("Line Count doesn't match", 9, lines.size());                                          
assertEquals("Line Count doesn't match", 9, idx);                                                      assertEquals("Line Count doesn't match", 9, idx);                                                   
assertEquals("Line Count doesn't match", 6, actualLines);                                              assertEquals("Line Count doesn't match", 6, actualLines);                                           
try {                                                                                                  try {                                                                                               
iterator.next();                                                                                       iterator.next();                                                                                    
fail("Expected NoSuchElementException");                                                               fail("Expected NoSuchElementException");                                                            
} catch (NoSuchElementException expected) {                                                            } catch (NoSuchElementException expected) {                                                         
}                                                                                                      }                                                                                                   
try {                                                                                                  try {                                                                                               
iterator.nextLine();                                                                                   iterator.nextLine();                                                                                
fail("Expected NoSuchElementException");                                                               fail("Expected NoSuchElementException");                                                            
} catch (NoSuchElementException expected) {                                                            } catch (NoSuchElementException expected) {                                                         
}                                                                                                      }                                                                                                   
} finally {                                                                                            } finally {                                                                                         
LineIterator.closeQuietly(iterator);                                                                   LineIterator.closeQuietly(iterator);                                                                
}                                                                                                      }                                                                                                   
}                                                                                                      }                                                                                                   
