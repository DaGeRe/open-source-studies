public void testMoveFile_CopyDelete_Failed() throws Exception {                                        public void testMoveFile_CopyDelete_Failed() throws Exception {                                     
File destination = new File(getTestDirectory(), "move3.txt");                                          File destination = new File(getTestDirectory(), "move3.txt");                                       
File src = new File(testFile1.getAbsolutePath()) {                                                     File src = new File(testFile1.getAbsolutePath()) {                                                  
                                                                                                                                                                                                           
                                                                                                     | @Override                                                                                           
public boolean renameTo(File f) {                                                                      public boolean renameTo(File f) {                                                                   
return false;                                                                                          return false;                                                                                       
}                                                                                                      }                                                                                                   
                                                                                                                                                                                                           
                                                                                                     | @Override                                                                                           
public boolean delete() {                                                                              public boolean delete() {                                                                           
return false;                                                                                          return false;                                                                                       
}                                                                                                      }                                                                                                   
};                                                                                                     };                                                                                                  
try {                                                                                                  try {                                                                                               
FileUtils.moveFile(src, destination);                                                                  FileUtils.moveFile(src, destination);                                                               
fail("move should have failed as src has not been deleted");                                           fail("move should have failed as src has not been deleted");                                        
} catch (IOException e) {                                                                              } catch (IOException e) {                                                                           
assertTrue("Check Rollback", !destination.exists());                                                   assertTrue("Check Rollback", !destination.exists());                                                
assertTrue("Original exists", src.exists());                                                           assertTrue("Original exists", src.exists());                                                        
}                                                                                                      }                                                                                                   
}                                                                                                      }                                                                                                   
