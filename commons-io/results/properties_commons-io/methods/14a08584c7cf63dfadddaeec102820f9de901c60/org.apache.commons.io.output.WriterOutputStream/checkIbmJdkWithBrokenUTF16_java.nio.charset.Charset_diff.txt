private static void checkIbmJdkWithBrokenUTF16(Charset charset) {                                      private static void checkIbmJdkWithBrokenUTF16(Charset charset) {                                   
if (!"UTF-16".equals(charset.name()))                                                                | if (!"UTF-16".equals(charset.name())) {                                                             
return;                                                                                                return;                                                                                             
                                                                                                     | }                                                                                                   
final String TEST_STRING_2 = "v\u00e9s";                                                               final String TEST_STRING_2 = "v\u00e9s";                                                            
byte[] bytes = TEST_STRING_2.getBytes(charset);                                                        byte[] bytes = TEST_STRING_2.getBytes(charset);                                                     
final CharsetDecoder charsetDecoder2 = charset.newDecoder();                                           final CharsetDecoder charsetDecoder2 = charset.newDecoder();                                        
ByteBuffer bb2 = ByteBuffer.allocate(16);                                                              ByteBuffer bb2 = ByteBuffer.allocate(16);                                                           
CharBuffer cb2 = CharBuffer.allocate(TEST_STRING_2.length());                                          CharBuffer cb2 = CharBuffer.allocate(TEST_STRING_2.length());                                       
final int len = bytes.length;                                                                          final int len = bytes.length;                                                                       
for (int i = 0; i &lt; len; i++) {                                                                     for (int i = 0; i &lt; len; i++) {                                                                  
bb2.put(bytes[i]);                                                                                     bb2.put(bytes[i]);                                                                                  
bb2.flip();                                                                                            bb2.flip();                                                                                         
try {                                                                                                  try {                                                                                               
charsetDecoder2.decode(bb2, cb2, i == (len - 1));                                                      charsetDecoder2.decode(bb2, cb2, i == (len - 1));                                                   
} catch (IllegalArgumentException e) {                                                                 } catch (IllegalArgumentException e) {                                                              
throw new UnsupportedOperationException("UTF-16 requested when runninng on an IBM JDK with broken UT   throw new UnsupportedOperationException("UTF-16 requested when runninng on an IBM JDK with broken UT
}                                                                                                      }                                                                                                   
bb2.compact();                                                                                         bb2.compact();                                                                                      
}                                                                                                      }                                                                                                   
cb2.rewind();                                                                                          cb2.rewind();                                                                                       
if (!TEST_STRING_2.equals(cb2.toString())) {                                                           if (!TEST_STRING_2.equals(cb2.toString())) {                                                        
throw new UnsupportedOperationException("UTF-16 requested when runninng on an IBM JDK with broken UT   throw new UnsupportedOperationException("UTF-16 requested when runninng on an IBM JDK with broken UT
}                                                                                                      }                                                                                                   
;                                                                                                      ;                                                                                                   
}                                                                                                      }                                                                                                   
