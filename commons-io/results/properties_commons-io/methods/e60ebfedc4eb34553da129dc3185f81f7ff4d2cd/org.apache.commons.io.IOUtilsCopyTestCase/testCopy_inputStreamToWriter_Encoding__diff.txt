public void testCopy_inputStreamToWriter_Encoding() throws Exception {                                 public void testCopy_inputStreamToWriter_Encoding() throws Exception {                              
InputStream in = new ByteArrayInputStream(inData);                                                     InputStream in = new ByteArrayInputStream(inData);                                                  
in = new YellOnCloseInputStream(in);                                                                   in = new YellOnCloseInputStream(in);                                                                
ByteArrayOutputStream baout = new ByteArrayOutputStream();                                             ByteArrayOutputStream baout = new ByteArrayOutputStream();                                          
YellOnFlushAndCloseOutputStream out = new YellOnFlushAndCloseOutputStream(baout, true, true);          YellOnFlushAndCloseOutputStream out = new YellOnFlushAndCloseOutputStream(baout, true, true);       
Writer writer = new OutputStreamWriter(baout, "US-ASCII");                                             Writer writer = new OutputStreamWriter(baout, "US-ASCII");                                          
IOUtils.copy(in, writer, "UTF8");                                                                      IOUtils.copy(in, writer, "UTF8");                                                                   
out.off();                                                                                             out.off();                                                                                          
writer.flush();                                                                                        writer.flush();                                                                                     
assertTrue("Not all bytes were read", in.available() == 0);                                          | assertEquals("Not all bytes were read", 0, in.available());                                         
byte[] bytes = baout.toByteArray();                                                                    byte[] bytes = baout.toByteArray();                                                                 
bytes = new String(bytes, "UTF8").getBytes("US-ASCII");                                                bytes = new String(bytes, "UTF8").getBytes("US-ASCII");                                             
assertTrue("Content differs", Arrays.equals(inData, bytes));                                           assertTrue("Content differs", Arrays.equals(inData, bytes));                                        
}                                                                                                      }                                                                                                   
