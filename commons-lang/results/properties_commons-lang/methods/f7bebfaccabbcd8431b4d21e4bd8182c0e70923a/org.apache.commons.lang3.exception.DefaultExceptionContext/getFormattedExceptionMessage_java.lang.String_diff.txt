/**                                                                                                    /**                                                                                                 
* Builds the message containing the contextual information.                                            * Builds the message containing the contextual information.                                         
*                                                                                                      *                                                                                                   
* @param baseMessage  the base exception message &lt;b&gt;without&lt;/b&gt; context information appe   * @param baseMessage  the base exception message &lt;b&gt;without&lt;/b&gt; context information appe
* @return the exception message &lt;b&gt;with&lt;/b&gt; context information appended, never null       * @return the exception message &lt;b&gt;with&lt;/b&gt; context information appended, never null    
*/                                                                                                     */                                                                                                  
public String getFormattedExceptionMessage(String baseMessage) {                                       public String getFormattedExceptionMessage(String baseMessage) {                                    
StringBuilder buffer = new StringBuilder(256);                                                         StringBuilder buffer = new StringBuilder(256);                                                      
if (baseMessage != null) {                                                                             if (baseMessage != null) {                                                                          
buffer.append(baseMessage);                                                                            buffer.append(baseMessage);                                                                         
}                                                                                                      }                                                                                                   
if (contextValues.size() &gt; 0) {                                                                     if (contextValues.size() &gt; 0) {                                                                  
if (buffer.length() &gt; 0) {                                                                          if (buffer.length() &gt; 0) {                                                                       
buffer.append('\n');                                                                                   buffer.append('\n');                                                                                
}                                                                                                      }                                                                                                   
buffer.append("Exception Context:\n");                                                                 buffer.append("Exception Context:\n");                                                              
Object value;                                                                                        | int i = 0;                                                                                          
String valueStr;                                                                                     |                                                                                                     
for (final Pair&lt;String, Object&gt; pair : contextValues) {                                          for (final Pair&lt;String, Object&gt; pair : contextValues) {                                       
buffer.append("\t[");                                                                                  buffer.append("\t[");                                                                               
                                                                                                     | buffer.append(++i);                                                                                 
                                                                                                     | buffer.append(':');                                                                                 
buffer.append(pair.getKey());                                                                          buffer.append(pair.getKey());                                                                       
buffer.append("=");                                                                                    buffer.append("=");                                                                                 
value = pair.getValue();                                                                             | final Object value = pair.getValue();                                                               
if (value == null) {                                                                                   if (value == null) {                                                                                
buffer.append("null");                                                                                 buffer.append("null");                                                                              
} else {                                                                                               } else {                                                                                            
                                                                                                     | String valueStr;                                                                                    
try {                                                                                                  try {                                                                                               
valueStr = value.toString();                                                                           valueStr = value.toString();                                                                        
} catch (Exception e) {                                                                                } catch (Exception e) {                                                                             
valueStr = "Exception thrown on toString(): " + ExceptionUtils.getStackTrace(e);                       valueStr = "Exception thrown on toString(): " + ExceptionUtils.getStackTrace(e);                    
}                                                                                                      }                                                                                                   
buffer.append(valueStr);                                                                               buffer.append(valueStr);                                                                            
}                                                                                                      }                                                                                                   
buffer.append("]\n");                                                                                  buffer.append("]\n");                                                                               
}                                                                                                      }                                                                                                   
buffer.append("---------------------------------");                                                    buffer.append("---------------------------------");                                                 
}                                                                                                      }                                                                                                   
return buffer.toString();                                                                              return buffer.toString();                                                                           
}                                                                                                      }                                                                                                   
