/**                                                                                                    /**                                                                                                 
* &lt;p&gt;Append to the &lt;code&gt;toString&lt;/code&gt; an &lt;code&gt;Object&lt;/code&gt;,         * &lt;p&gt;Append to the &lt;code&gt;toString&lt;/code&gt; an &lt;code&gt;Object&lt;/code&gt;,      
* correctly interpreting its type.&lt;/p&gt;                                                           * correctly interpreting its type.&lt;/p&gt;                                                        
*                                                                                                      *                                                                                                   
* &lt;p&gt;This method performs the main lookup by Class type to correctly                             * &lt;p&gt;This method performs the main lookup by Class type to correctly                          
* route arrays, &lt;code&gt;Collections&lt;/code&gt;, &lt;code&gt;Maps&lt;/code&gt; and                * route arrays, &lt;code&gt;Collections&lt;/code&gt;, &lt;code&gt;Maps&lt;/code&gt; and             
* &lt;code&gt;Objects&lt;/code&gt; to the appropriate method.&lt;/p&gt;                                * &lt;code&gt;Objects&lt;/code&gt; to the appropriate method.&lt;/p&gt;                             
*                                                                                                      *                                                                                                   
* &lt;p&gt;Either detail or summary views can be specified.&lt;/p&gt;                                  * &lt;p&gt;Either detail or summary views can be specified.&lt;/p&gt;                               
*                                                                                                      *                                                                                                   
* &lt;p&gt;If a cycle is detected, an object will be appended with the                                 * &lt;p&gt;If a cycle is detected, an object will be appended with the                              
* &lt;code&gt;Object.toString()&lt;/code&gt; format.&lt;/p&gt;                                         * &lt;code&gt;Object.toString()&lt;/code&gt; format.&lt;/p&gt;                                      
*                                                                                                      *                                                                                                   
* @param buffer  the &lt;code&gt;StringBuffer&lt;/code&gt; to populate                                 * @param buffer  the &lt;code&gt;StringBuffer&lt;/code&gt; to populate                              
* @param fieldName  the field name, typically not used as already appended                             * @param fieldName  the field name, typically not used as already appended                          
* @param value  the value to add to the &lt;code&gt;toString&lt;/code&gt;,                             * @param value  the value to add to the &lt;code&gt;toString&lt;/code&gt;,                          
*  not &lt;code&gt;null&lt;/code&gt;                                                                   *  not &lt;code&gt;null&lt;/code&gt;                                                                
* @param detail  output detail or not                                                                  * @param detail  output detail or not                                                               
*/                                                                                                     */                                                                                                  
protected void appendInternal(StringBuffer buffer, String fieldName, Object value, boolean detail) {   protected void appendInternal(StringBuffer buffer, String fieldName, Object value, boolean detail) {
if (isRegistered(value) && !(value instanceof Number || value instanceof Boolean || value instanceof   if (isRegistered(value) && !(value instanceof Number || value instanceof Boolean || value instanceof
appendCyclicObject(buffer, fieldName, value);                                                          appendCyclicObject(buffer, fieldName, value);                                                       
return;                                                                                                return;                                                                                             
}                                                                                                      }                                                                                                   
register(value);                                                                                       register(value);                                                                                    
try {                                                                                                  try {                                                                                               
if (value instanceof Collection) {                                                                   | if (value instanceof Collection&lt;?&gt;) {                                                         
if (detail) {                                                                                          if (detail) {                                                                                       
appendDetail(buffer, fieldName, (Collection) value);                                                 | appendDetail(buffer, fieldName, (Collection&lt;?&gt;) value);                                       
} else {                                                                                               } else {                                                                                            
appendSummarySize(buffer, fieldName, ((Collection) value).size());                                   | appendSummarySize(buffer, fieldName, ((Collection&lt;?&gt;) value).size());                         
}                                                                                                      }                                                                                                   
} else if (value instanceof Map) {                                                                   | } else if (value instanceof Map&lt;?, ?&gt;) {                                                      
if (detail) {                                                                                          if (detail) {                                                                                       
appendDetail(buffer, fieldName, (Map) value);                                                        | appendDetail(buffer, fieldName, (Map&lt;?, ?&gt;) value);                                           
} else {                                                                                               } else {                                                                                            
appendSummarySize(buffer, fieldName, ((Map) value).size());                                          | appendSummarySize(buffer, fieldName, ((Map&lt;?, ?&gt;) value).size());                             
}                                                                                                      }                                                                                                   
} else if (value instanceof long[]) {                                                                  } else if (value instanceof long[]) {                                                               
if (detail) {                                                                                          if (detail) {                                                                                       
appendDetail(buffer, fieldName, (long[]) value);                                                       appendDetail(buffer, fieldName, (long[]) value);                                                    
} else {                                                                                               } else {                                                                                            
appendSummary(buffer, fieldName, (long[]) value);                                                      appendSummary(buffer, fieldName, (long[]) value);                                                   
}                                                                                                      }                                                                                                   
} else if (value instanceof int[]) {                                                                   } else if (value instanceof int[]) {                                                                
if (detail) {                                                                                          if (detail) {                                                                                       
appendDetail(buffer, fieldName, (int[]) value);                                                        appendDetail(buffer, fieldName, (int[]) value);                                                     
} else {                                                                                               } else {                                                                                            
appendSummary(buffer, fieldName, (int[]) value);                                                       appendSummary(buffer, fieldName, (int[]) value);                                                    
}                                                                                                      }                                                                                                   
} else if (value instanceof short[]) {                                                                 } else if (value instanceof short[]) {                                                              
if (detail) {                                                                                          if (detail) {                                                                                       
appendDetail(buffer, fieldName, (short[]) value);                                                      appendDetail(buffer, fieldName, (short[]) value);                                                   
} else {                                                                                               } else {                                                                                            
appendSummary(buffer, fieldName, (short[]) value);                                                     appendSummary(buffer, fieldName, (short[]) value);                                                  
}                                                                                                      }                                                                                                   
} else if (value instanceof byte[]) {                                                                  } else if (value instanceof byte[]) {                                                               
if (detail) {                                                                                          if (detail) {                                                                                       
appendDetail(buffer, fieldName, (byte[]) value);                                                       appendDetail(buffer, fieldName, (byte[]) value);                                                    
} else {                                                                                               } else {                                                                                            
appendSummary(buffer, fieldName, (byte[]) value);                                                      appendSummary(buffer, fieldName, (byte[]) value);                                                   
}                                                                                                      }                                                                                                   
} else if (value instanceof char[]) {                                                                  } else if (value instanceof char[]) {                                                               
if (detail) {                                                                                          if (detail) {                                                                                       
appendDetail(buffer, fieldName, (char[]) value);                                                       appendDetail(buffer, fieldName, (char[]) value);                                                    
} else {                                                                                               } else {                                                                                            
appendSummary(buffer, fieldName, (char[]) value);                                                      appendSummary(buffer, fieldName, (char[]) value);                                                   
}                                                                                                      }                                                                                                   
} else if (value instanceof double[]) {                                                                } else if (value instanceof double[]) {                                                             
if (detail) {                                                                                          if (detail) {                                                                                       
appendDetail(buffer, fieldName, (double[]) value);                                                     appendDetail(buffer, fieldName, (double[]) value);                                                  
} else {                                                                                               } else {                                                                                            
appendSummary(buffer, fieldName, (double[]) value);                                                    appendSummary(buffer, fieldName, (double[]) value);                                                 
}                                                                                                      }                                                                                                   
} else if (value instanceof float[]) {                                                                 } else if (value instanceof float[]) {                                                              
if (detail) {                                                                                          if (detail) {                                                                                       
appendDetail(buffer, fieldName, (float[]) value);                                                      appendDetail(buffer, fieldName, (float[]) value);                                                   
} else {                                                                                               } else {                                                                                            
appendSummary(buffer, fieldName, (float[]) value);                                                     appendSummary(buffer, fieldName, (float[]) value);                                                  
}                                                                                                      }                                                                                                   
} else if (value instanceof boolean[]) {                                                               } else if (value instanceof boolean[]) {                                                            
if (detail) {                                                                                          if (detail) {                                                                                       
appendDetail(buffer, fieldName, (boolean[]) value);                                                    appendDetail(buffer, fieldName, (boolean[]) value);                                                 
} else {                                                                                               } else {                                                                                            
appendSummary(buffer, fieldName, (boolean[]) value);                                                   appendSummary(buffer, fieldName, (boolean[]) value);                                                
}                                                                                                      }                                                                                                   
} else if (value.getClass().isArray()) {                                                               } else if (value.getClass().isArray()) {                                                            
if (detail) {                                                                                          if (detail) {                                                                                       
appendDetail(buffer, fieldName, (Object[]) value);                                                     appendDetail(buffer, fieldName, (Object[]) value);                                                  
} else {                                                                                               } else {                                                                                            
appendSummary(buffer, fieldName, (Object[]) value);                                                    appendSummary(buffer, fieldName, (Object[]) value);                                                 
}                                                                                                      }                                                                                                   
} else {                                                                                               } else {                                                                                            
if (detail) {                                                                                          if (detail) {                                                                                       
appendDetail(buffer, fieldName, value);                                                                appendDetail(buffer, fieldName, value);                                                             
} else {                                                                                               } else {                                                                                            
appendSummary(buffer, fieldName, value);                                                               appendSummary(buffer, fieldName, value);                                                            
}                                                                                                      }                                                                                                   
}                                                                                                      }                                                                                                   
} finally {                                                                                            } finally {                                                                                         
unregister(value);                                                                                     unregister(value);                                                                                  
}                                                                                                      }                                                                                                   
}                                                                                                      }                                                                                                   
