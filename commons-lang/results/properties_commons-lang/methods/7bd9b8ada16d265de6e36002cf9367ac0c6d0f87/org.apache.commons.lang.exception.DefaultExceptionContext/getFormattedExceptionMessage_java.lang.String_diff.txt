/**                                                                                                    /**                                                                                                 
* Centralized message logic for both checked and unchecked version of                                  * Centralized message logic for both checked and unchecked version of                               
* context exceptions                                                                                   * context exceptions                                                                                
* @param baseMessage message retained by super class                                                   * @param baseMessage message retained by super class                                                
* @return message -- exception message                                                                 * @return message -- exception message                                                              
* @since 3.0                                                                                           * @since 3.0                                                                                        
*/                                                                                                     */                                                                                                  
public String getFormattedExceptionMessage(String baseMessage) {                                       public String getFormattedExceptionMessage(String baseMessage) {                                    
StringBuffer buffer = new StringBuffer(256);                                                           StringBuffer buffer = new StringBuffer(256);                                                        
if (baseMessage != null) {                                                                             if (baseMessage != null) {                                                                          
buffer.append(baseMessage);                                                                            buffer.append(baseMessage);                                                                         
}                                                                                                      }                                                                                                   
if (contextKeyList.size() &gt; 0) {                                                                    if (contextKeyList.size() &gt; 0) {                                                                 
                                                                                                     | if (buffer.length() &gt; 0l) {                                                                      
buffer.append(SystemUtils.LINE_SEPARATOR);                                                             buffer.append(SystemUtils.LINE_SEPARATOR);                                                          
                                                                                                     | }                                                                                                   
buffer.append("Exception Context:");                                                                   buffer.append("Exception Context:");                                                                
buffer.append(SystemUtils.LINE_SEPARATOR);                                                             buffer.append(SystemUtils.LINE_SEPARATOR);                                                          
buffer.append("\t");                                                                                   buffer.append("\t");                                                                                
Object value;                                                                                          Object value;                                                                                       
String valueStr;                                                                                       String valueStr;                                                                                    
for (String label : this.contextKeyList) {                                                             for (String label : this.contextKeyList) {                                                          
buffer.append("[");                                                                                    buffer.append("[");                                                                                 
buffer.append(label);                                                                                  buffer.append(label);                                                                               
buffer.append("=");                                                                                    buffer.append("=");                                                                                 
value = this.contextValueMap.get(label);                                                               value = this.contextValueMap.get(label);                                                            
if (value == null) {                                                                                   if (value == null) {                                                                                
buffer.append("null");                                                                                 buffer.append("null");                                                                              
} else {                                                                                               } else {                                                                                            
try {                                                                                                  try {                                                                                               
valueStr = value.toString();                                                                           valueStr = value.toString();                                                                        
} catch (Throwable t) {                                                                                } catch (Throwable t) {                                                                             
valueStr = "Excepted on toString(): " + ExceptionUtils.getStackTrace(t);                               valueStr = "Excepted on toString(): " + ExceptionUtils.getStackTrace(t);                            
}                                                                                                      }                                                                                                   
buffer.append(valueStr);                                                                               buffer.append(valueStr);                                                                            
}                                                                                                      }                                                                                                   
buffer.append("]");                                                                                    buffer.append("]");                                                                                 
buffer.append(SystemUtils.LINE_SEPARATOR);                                                             buffer.append(SystemUtils.LINE_SEPARATOR);                                                          
buffer.append("\t");                                                                                   buffer.append("\t");                                                                                
}                                                                                                      }                                                                                                   
buffer.append(SystemUtils.LINE_SEPARATOR);                                                           | buffer.append("---------------------------------");                                                 
buffer.append("\t---------------------------------");                                                |                                                                                                     
}                                                                                                      }                                                                                                   
return buffer.toString();                                                                              return buffer.toString();                                                                           
}                                                                                                      }                                                                                                   
