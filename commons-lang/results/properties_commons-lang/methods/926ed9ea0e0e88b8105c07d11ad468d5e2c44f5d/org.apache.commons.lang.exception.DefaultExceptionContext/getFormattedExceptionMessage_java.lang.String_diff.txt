/**                                                                                                    /**                                                                                                 
* Centralized message logic for both checked and unchecked version of                                | * Builds the message containing the contextual information.                                         
* context exceptions                                                                                 | *                                                                                                   
* @param baseMessage message retained by super class                                                 | * @param baseMessage  the base exception message &lt;b&gt;without&lt;/b&gt; context information appe
* @return message -- exception message                                                               | * @return the exception message &lt;b&gt;with&lt;/b&gt; context information appended, never null    
* @since 3.0                                                                                         |                                                                                                     
*/                                                                                                     */                                                                                                  
public String getFormattedExceptionMessage(String baseMessage) {                                       public String getFormattedExceptionMessage(String baseMessage) {                                    
StringBuilder buffer = new StringBuilder(256);                                                         StringBuilder buffer = new StringBuilder(256);                                                      
if (baseMessage != null) {                                                                             if (baseMessage != null) {                                                                          
buffer.append(baseMessage);                                                                            buffer.append(baseMessage);                                                                         
}                                                                                                      }                                                                                                   
if (contextKeyList.size() &gt; 0) {                                                                  | if (contextValueMap.size() &gt; 0) {                                                                
if (buffer.length() &gt; 0l) {                                                                         if (buffer.length() &gt; 0l) {                                                                      
buffer.append(SystemUtils.LINE_SEPARATOR);                                                             buffer.append(SystemUtils.LINE_SEPARATOR);                                                          
}                                                                                                      }                                                                                                   
buffer.append("Exception Context:");                                                                   buffer.append("Exception Context:");                                                                
buffer.append(SystemUtils.LINE_SEPARATOR);                                                             buffer.append(SystemUtils.LINE_SEPARATOR);                                                          
buffer.append("\t");                                                                                   buffer.append("\t");                                                                                
Object value;                                                                                          Object value;                                                                                       
String valueStr;                                                                                       String valueStr;                                                                                    
for (String label : this.contextKeyList) {                                                           | for (String label : contextValueMap.keySet()) {                                                     
buffer.append("[");                                                                                    buffer.append("[");                                                                                 
buffer.append(label);                                                                                  buffer.append(label);                                                                               
buffer.append("=");                                                                                    buffer.append("=");                                                                                 
value = this.contextValueMap.get(label);                                                               value = this.contextValueMap.get(label);                                                            
if (value == null) {                                                                                   if (value == null) {                                                                                
buffer.append("null");                                                                                 buffer.append("null");                                                                              
} else {                                                                                               } else {                                                                                            
try {                                                                                                  try {                                                                                               
valueStr = value.toString();                                                                           valueStr = value.toString();                                                                        
} catch (Throwable t) {                                                                                } catch (Throwable t) {                                                                             
valueStr = "Excepted on toString(): " + ExceptionUtils.getStackTrace(t);                               valueStr = "Excepted on toString(): " + ExceptionUtils.getStackTrace(t);                            
}                                                                                                      }                                                                                                   
buffer.append(valueStr);                                                                               buffer.append(valueStr);                                                                            
}                                                                                                      }                                                                                                   
buffer.append("]");                                                                                    buffer.append("]");                                                                                 
buffer.append(SystemUtils.LINE_SEPARATOR);                                                             buffer.append(SystemUtils.LINE_SEPARATOR);                                                          
buffer.append("\t");                                                                                   buffer.append("\t");                                                                                
}                                                                                                      }                                                                                                   
buffer.append("---------------------------------");                                                    buffer.append("---------------------------------");                                                 
}                                                                                                      }                                                                                                   
return buffer.toString();                                                                              return buffer.toString();                                                                           
}                                                                                                      }                                                                                                   
