/**                                                                                                    /**                                                                                                 
* Builds the message containing the contextual information.                                            * Builds the message containing the contextual information.                                         
*                                                                                                      *                                                                                                   
* @param baseMessage  the base exception message &lt;b&gt;without&lt;/b&gt; context information appe   * @param baseMessage  the base exception message &lt;b&gt;without&lt;/b&gt; context information appe
* @return the exception message &lt;b&gt;with&lt;/b&gt; context information appended, never null       * @return the exception message &lt;b&gt;with&lt;/b&gt; context information appended, never null    
*/                                                                                                     */                                                                                                  
public String getFormattedExceptionMessage(String baseMessage) {                                       public String getFormattedExceptionMessage(String baseMessage) {                                    
StringBuilder buffer = new StringBuilder(256);                                                         StringBuilder buffer = new StringBuilder(256);                                                      
if (baseMessage != null) {                                                                             if (baseMessage != null) {                                                                          
buffer.append(baseMessage);                                                                            buffer.append(baseMessage);                                                                         
}                                                                                                      }                                                                                                   
if (contextValueMap.size() &gt; 0) {                                                                 | if (contextValues.size() &gt; 0) {                                                                  
if (buffer.length() &gt; 0l) {                                                                       | if (buffer.length() &gt; 0) {                                                                       
buffer.append(SystemUtils.LINE_SEPARATOR);                                                           | buffer.append('\n');                                                                                
}                                                                                                      }                                                                                                   
buffer.append("Exception Context:");                                                                 | buffer.append("Exception Context:\n");                                                              
buffer.append(SystemUtils.LINE_SEPARATOR);                                                           |                                                                                                     
buffer.append("\t");                                                                                 |                                                                                                     
Object value;                                                                                          Object value;                                                                                       
String valueStr;                                                                                       String valueStr;                                                                                    
for (String label : contextValueMap.keySet()) {                                                      | for (final Pair&lt;String, Object&gt; pair : contextValues) {                                       
buffer.append("[");                                                                                  | buffer.append("\t[");                                                                               
buffer.append(label);                                                                                | buffer.append(pair.getKey());                                                                       
buffer.append("=");                                                                                    buffer.append("=");                                                                                 
value = this.contextValueMap.get(label);                                                             | value = pair.getValue();                                                                            
if (value == null) {                                                                                   if (value == null) {                                                                                
buffer.append("null");                                                                                 buffer.append("null");                                                                              
} else {                                                                                               } else {                                                                                            
try {                                                                                                  try {                                                                                               
valueStr = value.toString();                                                                           valueStr = value.toString();                                                                        
} catch (Exception e) {                                                                                } catch (Exception e) {                                                                             
valueStr = "Exception thrown on toString(): " + ExceptionUtils.getStackTrace(e);                       valueStr = "Exception thrown on toString(): " + ExceptionUtils.getStackTrace(e);                    
}                                                                                                      }                                                                                                   
buffer.append(valueStr);                                                                               buffer.append(valueStr);                                                                            
}                                                                                                      }                                                                                                   
buffer.append("]");                                                                                  | buffer.append("]\n");                                                                               
buffer.append(SystemUtils.LINE_SEPARATOR);                                                           |                                                                                                     
buffer.append("\t");                                                                                 |                                                                                                     
}                                                                                                      }                                                                                                   
buffer.append("---------------------------------");                                                    buffer.append("---------------------------------");                                                 
}                                                                                                      }                                                                                                   
return buffer.toString();                                                                              return buffer.toString();                                                                           
}                                                                                                      }                                                                                                   
