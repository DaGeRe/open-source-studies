/**                                                                                                    /**                                                                                                 
* &lt;p&gt;Unescapes any Java literals found in the &lt;code&gt;String&lt;/code&gt; to a               * &lt;p&gt;Unescapes any Java literals found in the &lt;code&gt;String&lt;/code&gt; to a            
* &lt;code&gt;Writer&lt;/code&gt;.&lt;/p&gt;                                                           * &lt;code&gt;Writer&lt;/code&gt;.&lt;/p&gt;                                                        
*                                                                                                      *                                                                                                   
* &lt;p&gt;For example, it will turn a sequence of &lt;code&gt;'\'&lt;/code&gt; and                    * &lt;p&gt;For example, it will turn a sequence of &lt;code&gt;'\'&lt;/code&gt; and                 
* &lt;code&gt;'n'&lt;/code&gt; into a newline character, unless the &lt;code&gt;'\'&lt;/code&gt;       * &lt;code&gt;'n'&lt;/code&gt; into a newline character, unless the &lt;code&gt;'\'&lt;/code&gt;    
* is preceded by another &lt;code&gt;'\'&lt;/code&gt;.&lt;/p&gt;                                       * is preceded by another &lt;code&gt;'\'&lt;/code&gt;.&lt;/p&gt;                                    
*                                                                                                      *                                                                                                   
* &lt;p&gt;A &lt;code&gt;null&lt;/code&gt; string input has no effect.&lt;/p&gt;                       * &lt;p&gt;A &lt;code&gt;null&lt;/code&gt; string input has no effect.&lt;/p&gt;                    
*                                                                                                      *                                                                                                   
* @param out  the &lt;code&gt;Writer&lt;/code&gt; used to output unescaped characters                  * @param out  the &lt;code&gt;Writer&lt;/code&gt; used to output unescaped characters               
* @param str  the &lt;code&gt;String&lt;/code&gt; to unescape, may be null                             * @param str  the &lt;code&gt;String&lt;/code&gt; to unescape, may be null                          
* @throws IllegalArgumentException if the Writer is &lt;code&gt;null&lt;/code&gt;                      * @throws IllegalArgumentException if the Writer is &lt;code&gt;null&lt;/code&gt;                   
* @throws IOException if error occurs on underlying Writer                                             * @throws IOException if error occurs on underlying Writer                                          
*/                                                                                                     */                                                                                                  
public static void unescapeJava(Writer out, String str) throws IOException {                           public static void unescapeJava(Writer out, String str) throws IOException {                        
if (out == null) {                                                                                     if (out == null) {                                                                                  
throw new IllegalArgumentException("The Writer must not be null");                                     throw new IllegalArgumentException("The Writer must not be null");                                  
}                                                                                                      }                                                                                                   
if (str == null) {                                                                                     if (str == null) {                                                                                  
return;                                                                                                return;                                                                                             
}                                                                                                      }                                                                                                   
int sz = str.length();                                                                                 int sz = str.length();                                                                              
StringBuffer unicode = new StringBuffer(4);                                                            StringBuffer unicode = new StringBuffer(4);                                                         
boolean hadSlash = false;                                                                              boolean hadSlash = false;                                                                           
boolean inUnicode = false;                                                                             boolean inUnicode = false;                                                                          
for (int i = 0; i &lt; sz; i++) {                                                                      for (int i = 0; i &lt; sz; i++) {                                                                   
char ch = str.charAt(i);                                                                               char ch = str.charAt(i);                                                                            
if (inUnicode) {                                                                                       if (inUnicode) {                                                                                    
// if in unicode, then we're reading unicode                                                           // if in unicode, then we're reading unicode                                                        
// values in somehow                                                                                   // values in somehow                                                                                
unicode.append(ch);                                                                                    unicode.append(ch);                                                                                 
if (unicode.length() == 4) {                                                                           if (unicode.length() == 4) {                                                                        
// unicode now contains the four hex digits                                                            // unicode now contains the four hex digits                                                         
// which represents our unicode character                                                              // which represents our unicode character                                                           
try {                                                                                                  try {                                                                                               
int value = Integer.parseInt(unicode.toString(), 16);                                                  int value = Integer.parseInt(unicode.toString(), 16);                                               
out.write((char) value);                                                                               out.write((char) value);                                                                            
unicode.setLength(0);                                                                                  unicode.setLength(0);                                                                               
inUnicode = false;                                                                                     inUnicode = false;                                                                                  
hadSlash = false;                                                                                      hadSlash = false;                                                                                   
} catch (NumberFormatException nfe) {                                                                  } catch (NumberFormatException nfe) {                                                               
throw new NestableRuntimeException("Unable to parse unicode value: " + unicode, nfe);                | throw new UnhandledException("Unable to parse unicode value: " + unicode, nfe);                     
}                                                                                                      }                                                                                                   
}                                                                                                      }                                                                                                   
continue;                                                                                              continue;                                                                                           
}                                                                                                      }                                                                                                   
if (hadSlash) {                                                                                        if (hadSlash) {                                                                                     
// handle an escaped value                                                                             // handle an escaped value                                                                          
hadSlash = false;                                                                                      hadSlash = false;                                                                                   
switch(ch) {                                                                                           switch(ch) {                                                                                        
case '\\':                                                                                             case '\\':                                                                                          
out.write('\\');                                                                                       out.write('\\');                                                                                    
break;                                                                                                 break;                                                                                              
case '\'':                                                                                             case '\'':                                                                                          
out.write('\'');                                                                                       out.write('\'');                                                                                    
break;                                                                                                 break;                                                                                              
case '\"':                                                                                             case '\"':                                                                                          
out.write('"');                                                                                        out.write('"');                                                                                     
break;                                                                                                 break;                                                                                              
case 'r':                                                                                              case 'r':                                                                                           
out.write('\r');                                                                                       out.write('\r');                                                                                    
break;                                                                                                 break;                                                                                              
case 'f':                                                                                              case 'f':                                                                                           
out.write('\f');                                                                                       out.write('\f');                                                                                    
break;                                                                                                 break;                                                                                              
case 't':                                                                                              case 't':                                                                                           
out.write('\t');                                                                                       out.write('\t');                                                                                    
break;                                                                                                 break;                                                                                              
case 'n':                                                                                              case 'n':                                                                                           
out.write('\n');                                                                                       out.write('\n');                                                                                    
break;                                                                                                 break;                                                                                              
case 'b':                                                                                              case 'b':                                                                                           
out.write('\b');                                                                                       out.write('\b');                                                                                    
break;                                                                                                 break;                                                                                              
case 'u':                                                                                              case 'u':                                                                                           
{                                                                                                      {                                                                                                   
// uh-oh, we're in unicode country....                                                                 // uh-oh, we're in unicode country....                                                              
inUnicode = true;                                                                                      inUnicode = true;                                                                                   
break;                                                                                                 break;                                                                                              
}                                                                                                      }                                                                                                   
default:                                                                                               default:                                                                                            
out.write(ch);                                                                                         out.write(ch);                                                                                      
break;                                                                                                 break;                                                                                              
}                                                                                                      }                                                                                                   
continue;                                                                                              continue;                                                                                           
} else if (ch == '\\') {                                                                               } else if (ch == '\\') {                                                                            
hadSlash = true;                                                                                       hadSlash = true;                                                                                    
continue;                                                                                              continue;                                                                                           
}                                                                                                      }                                                                                                   
out.write(ch);                                                                                         out.write(ch);                                                                                      
}                                                                                                      }                                                                                                   
if (hadSlash) {                                                                                        if (hadSlash) {                                                                                     
// then we're in the weird case of a \ at the end of the                                               // then we're in the weird case of a \ at the end of the                                            
// string, let's output it anyway.                                                                     // string, let's output it anyway.                                                                  
out.write('\\');                                                                                       out.write('\\');                                                                                    
}                                                                                                      }                                                                                                   
}                                                                                                      }                                                                                                   
